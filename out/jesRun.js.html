<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: jesRun.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: jesRun.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Copyright Â© 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
*/
'use strict';

/**
 * Prepare data for runCompute(@async)
 * @module spBase
 * 
 * @param {object} store - restaf store
 * @param {object} args - args from graphql server(enhanced)
 * @param {string} src  - code to execute
 * 
 * @returns {object} computeSummary object
 * 
 */

import jesRunBase from './jesRunBase';

async function jesRun (store,jes, src, jobDefinitionName, args){
 
    // generate macro variables

    let jobRequest = {};
    //jobRequest.type = 'Compute';

    let jobDefinition = {};
    

    if (jobDefinitionName !== null) {
        debugger;
        jobRequest.jobDefinitionUri = await jobDefUri(store, jobDefinitionName);
    }
    debugger;


    // Concat macro to code
    if (src !=- null) {
       jobDefinition.code = src; /*src.split(/\r?\n/);*/
    }

    jobDefinition.type ='Compute';
    if (args !== null) {
        jobDefinition.parameters = args;
    }

   
    jobRequest.jobDefinition = jobDefinition;

    let payload = {
        data: jobRequest
    }
    // run code and get results
    debugger;
    console.log(JSON.stringify(payload, null,4));
    debugger;
    let jobResult = await jesRunBase(store, jes, payload);
    debugger;

    return jobResult;
}

async function jobDefUri (store, name) {
    let jobDef = store.getService('jobDefinitions');
    let uri = null;
    let payload = {
        qs: {
            filter: `eq(name,'${name}')`
        }
    }
    // call the reports service
    debugger;
    let jdefList = await jesRunBase(store, payload);
    debugger;
    if (jdefList.itemsList().size === 0) {
        throw `Error: ${name} not found in the system`;
    } 
    else {
        uri = jdefList.itemsCmd(name, 'self', 'link', 'uri')
    }
    return uri;
}
export default jesRun;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-casFetchData.html">casFetchData</a></li><li><a href="module-caslBase.html">caslBase</a></li><li><a href="module-caslScore.html">caslScore</a></li><li><a href="module-casSetup.html">casSetup</a></li><li><a href="module-casTableToJson.html">casTableToJson</a></li><li><a href="module-computeSetup.html">computeSetup</a></li><li><a href="module-computeSummary.html">computeSummary</a></li><li><a href="module-findReport.html">findReport</a></li><li><a href="module-getReportImage.html">getReportImage</a></li><li><a href="module-getReportUrl.html">getReportUrl</a></li><li><a href="module-getSASTableRows.html">getSASTableRows</a></li><li><a href="module-jesRunBase.html">jesRunBase</a></li><li><a href="module-jesSetup.html">jesSetup</a></li><li><a href="module-jsonToDict.html">jsonToDict</a></li><li><a href="module-runCompute.html">runCompute</a></li><li><a href="module-spBase.html">spBase</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Oct 21 2019 08:00:47 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
